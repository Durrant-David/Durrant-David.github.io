<html>
<head>
    <title>Topic 4</title>
</head>
<button onclick="getData('books.txt', displayBooks)">load Books</button>
<button onclick="getData(
                 'https://salty-tundra-18278.herokuapp.com/index.php/lookup/api'
                 , displayLookup)">load Lookup</button>

<body>
    <h2>XMLHTTPRequest</h2>
    <p id="JSON"></p>

    <script>
        function createCORSRequest(method, url) {
            var xhr = new XMLHttpRequest();
            if ("withCredentials" in xhr) {

                // Check if the XMLHttpRequest object has a "withCredentials" property.
                // "withCredentials" only exists on XMLHTTPRequest2 objects.
                xhr.open(method, url, true);

            } else if (typeof XDomainRequest != "undefined") {

                // Otherwise, check if XDomainRequest.
                // XDomainRequest only exists in IE, and is IE's way of making CORS requests.
                xhr = new XDomainRequest();
                xhr.open(method, url);

            } else {

                // Otherwise, CORS is not supported by the browser.
                xhr = null;

            }
            return xhr;
        }

        var xhr = createCORSRequest('GET', 'https://salty-tundra-18278.herokuapp.com/index.php/lookup/api');
        if (!xhr) {
            throw new Error('CORS not supported');
        }
        console.log(xhr);

        function getData(url, callback) {
            var xmlhttp = new XMLHttpRequest();

            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var data = JSON.parse(this.responseText);
                    callback(data);
                }
            };
            xmlhttp.open("GET", url, true);
            xmlhttp.setRequestHeader("Content-Type", "application/json");
            xmlhttp.withCredentials = false;
            xmlhttp.send();
        }

        function displayBooks(books) {
            var out = "";
            var x;
            for (x in books) {
                out += '<p>Title: ' + books[x].title + '<br> Author: ' + books[x].author + '<br> Published: ' + books[x].published + '<br> Pages: ' + books[x].pages + '</p>';
            }
            document.getElementById("JSON").innerHTML = out;
        }

        function displayLookup(items) {
            console.log(items);
            var out = "";
            var x;
            for (x in items) {
                console.log(items[x]);
                out += '<p>Type: ' + items[x].type + ' Level: ' + items[x].levels + ' Catwalk: ' + items[x].catwalk + ' Chairs: ' + items[x].chairs + ' light: ' + items[x].light + ' Status: ' + items[x].status + '</p>';
            }
            document.getElementById("JSON").innerHTML = out;
        }
    </script>
</body>
</html>